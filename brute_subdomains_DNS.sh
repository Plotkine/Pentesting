#!/bin/bash

#https://github.com/Plotkine/Pentesting

#Description: Queries DNS server for PTR records in the specified network
#colors: white=\e[97m red=\e[91m green=\e[92m light grey=\e[37m
#fonts: normal= \033[0m bold=\033[1m

#-------------------------------------------------------

# CHECKS

#number of parameters
if (( $#<4 || $#>4 ))
then
        echo -e "\e[92mDescription:\e[97m queries DNS sever for subdomains of specified domain"
        echo -e "\e[92mUsage:\e[97m bash brute_subdomains_DNS.sh [domain] [DNS server] [dictionary] [time]" #green
	echo -e "- domain = domain to bruteforce"
	echo -e "- DNS server = DNS server to query"
	echo -e "- dictionary = full path to dictionary containing subdomains"
	echo -e "- time = time to wait between each DNS query"
	echo -e "\e[92mExample:\e[97m bash brute_subdomains_DNS.sh doma1n.com 192.168.0.2 /usr/share/fierce/hosts.txt 2"
        exit 0
fi

export time=$4
export DNSServer=$2

#ping DNS Server
ping $DNSServer -c 1 -q -W $time &>/dev/null #trying to reach the URL within $time seconds
                         #&>/dev/null = >/dev/null 2>&1 = redirecting STDERR and STDOUT to /dev/null
if [ "$?" != "0" ]
then
   echo -e "\e[97mError: \e[91mDNS server unreachable\e[97m" #red
   exit 0
else
        echo -e "\e[92mDNS server reachable\e[97m"
fi

#-------------------------------------------------------
#CODE
export domain=$1
export file=$3
for name in $(cat $file)
do
	host $name.$domain $DNSServer -W $time |grep 'has address'
done
